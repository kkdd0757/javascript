# CH.23-24 클로저, 실행 컨텍스트

## 실행 컨텍스트

- 스코프와 식별자를 관리하고 코드 실행 순서 관리

- 렉시컬 환경과 실행 컨텍스트 스택으로 이루어짐

- 렉시컬 환경 : 어디서 정의되었는지에 따라 상위 스코프가 결정됨

- 순서

	1) 코드소스가 실행되면 전역 실행 컨텍스트가 생성되고  스택에 push됨 (빈객체인 상태) 

	2) 전역 렉시컬 환경이 만들어지고 전역 실행 컨텍스트와 바인딩됨

	3) 전역 실행 컨텍스트에는 환경 레코드와 외부 렉시컬 환경에 의한 참조로 나뉘어 진다. 환경 레코드에는 객체 환경 레코드와 선언적 환경 레코드가 존재하는데 객체 환경 레코드에는 전역함, var이 bindingObject에 의해 선언이전에 생성된다. 반면, 선언적 환경 레코드에는 let,const인 변수가 선언되는데 선언부터 초기화단계까지 일시적 사각 지대가 되어 선언전 참조시 오류가 난다. 

	4) 전역에서 globalThisValue를 통해 전역 객체와 바인딩한다.

	5) 함수를 실행하며 위와 유사한 과정을 반복한다. 단, 차이점이 있다면 전역일때는 빈 실행 컨텍스트가 먼저 생성이 되었다면, 함수 실행 컨텍스트의 경우는 렉시컬 환경이 먼저 생성이 된다. 그리고 전역 환경 레코드와는 달리 함수 렉시컬 환경만 생성이 된다. 

- 클래스 필드 : 클래스가 생성할 인스턴스의 프로퍼티

- 블록 레벨 스코프의 경우, 코드 블록이 생겨나면 렉시컬 환경이 만들어지고 글로벌 렉시컬에서 블록 렉시컬로 바뀐다. 

## 클로저

- 내부함수가 외부함수보다 생명주기가 길고, 내부함수에서 외부함수의 변수(자유변수)를 참조하는 현상

- 자바스크립트의 모든 객체는 클로저다 (모든 객체는 Environment라는 내부 슬롯에 자신의 상위 스코프 참조값을 가지기때문이다). 하지만 우리는 모든 객체를 클로저라고 부르지않고, 위의 경우만 일반적으로 클로저라고 부른다. 

- 모던 브라우저에서는 만약 참조하고 있지 않는 값이 있다면 메모리를 위해 가비지 컬렉터로 수집을해서 이제 더이상 메모리 이슈는 없다. 그러니까 클로저를 활용하자!! 
